{% extends 'html/base.html' %}
{% load static %}

{% block title %}Gallery Photos - Admin{% endblock %}

{% block navbar %}
<nav
    class="tw-fixed tw-top-0 tw-left-0 tw-w-full tw-z-50 tw-bg-white/90 tw-backdrop-blur-xl tw-border-b tw-border-slate-100">
    <div class="tw-max-w-7xl tw-mx-auto tw-px-6 tw-h-20 tw-flex tw-items-center tw-justify-between">
        <a href="{% url 'admin_dashboard' %}" class="tw-text-2xl tw-font-black tw-text-slate-900">HealthGate <span
                class="tw-text-blue-600">Admin</span></a>
        <div class="tw-flex tw-gap-8 tw-items-center tw-text-sm tw-font-bold tw-text-slate-600">
            <a href="{% url 'admin_dashboard' %}" class="hover:tw-text-blue-600">Dashboard</a>
            <a href="{% url 'admin_enquiries' %}" class="hover:tw-text-blue-600">Enquiries</a>
            <a href="{% url 'admin_appointments' %}" class="hover:tw-text-blue-600">Appointments</a>

            <div class="tw-relative tw-group">
                <button
                    class="hover:tw-text-blue-600 tw-text-blue-600 tw-flex tw-items-center tw-gap-1.5 tw-transition-colors">
                    Gallery <i
                        class="bi bi-chevron-down tw-text-[10px] tw-transition-transform group-hover:tw-rotate-180"></i>
                </button>
                <div
                    class="tw-absolute tw-top-[calc(100%+0.5rem)] tw-left-0 tw-w-48 tw-bg-white tw-border tw-border-slate-100 tw-rounded-2xl tw-shadow-2xl tw-opacity-0 tw-invisible group-hover:tw-opacity-100 group-hover:tw-visible tw-transition-all tw-duration-300 tw-translate-y-2 group-hover:tw-translate-y-0 tw-z-50 tw-overflow-hidden">
                    <div class="tw-py-2">
                        <a href="{% url 'admin_gallery_photos' %}"
                            class="tw-flex tw-items-center tw-gap-3 tw-px-6 tw-py-3 hover:tw-bg-slate-50 tw-text-slate-600 hover:tw-text-blue-600">
                            <i class="bi bi-images"></i> Photos
                        </a>
                        <a href="{% url 'admin_gallery_videos' %}"
                            class="tw-flex tw-items-center tw-gap-3 tw-px-6 tw-py-3 hover:tw-bg-slate-50 tw-text-slate-600 hover:tw-text-blue-600">
                            <i class="bi bi-play-circle-fill"></i> Videos
                        </a>
                    </div>
                </div>
            </div>
            <a href="{% url 'admin_blogs' %}" class="hover:tw-text-blue-600">Blogs</a>
            <a href="{% url 'home' %}"
                class="tw-bg-slate-100 tw-px-4 tw-py-2 tw-rounded-xl hover:tw-bg-slate-200 tw-transition-all">View
                Site</a>
        </div>
    </div>
</nav>
{% endblock %}

{% block footer %}{% endblock %}

{% block content %}
<div
    class="tw-min-h-screen tw-bg-gradient-to-br tw-from-slate-50 tw-via-blue-50 tw-to-slate-100 tw-pt-32 tw-pb-12 tw-px-[5%]">
    <div class="tw-max-w-7xl tw-mx-auto">
        <!-- Header -->
        <div class="tw-flex tw-items-center tw-justify-between tw-mb-12">
            <div>
                <h1 class="tw-text-5xl tw-font-black tw-text-slate-900">Photo <span
                        class="tw-text-blue-600">Gallery</span></h1>
                <p class="tw-text-slate-500 tw-mt-2">Managing clinical photography and medical imaging.</p>
            </div>
            <button onclick="document.getElementById('add-modal').classList.remove('tw-hidden')"
                class="tw-bg-blue-600 tw-text-white tw-px-8 tw-py-3.5 tw-rounded-2xl tw-font-bold hover:tw-bg-blue-700 tw-transition-all tw-shadow-lg tw-shadow-blue-600/20 tw-flex tw-items-center tw-gap-2">
                <i class="bi bi-plus-lg"></i> Add Photo
            </button>
        </div>

        <!-- Photo Grid -->
        <div class="tw-grid tw-grid-cols-1 md:tw-grid-cols-3 tw-gap-8">
            {% for photo in photos %}
            <div
                class="tw-group tw-bg-white tw-rounded-[2.5rem] tw-shadow-xl tw-border tw-border-slate-100 tw-overflow-hidden tw-relative">
                <div class="tw-aspect-square tw-overflow-hidden tw-bg-slate-100">
                    <img src="{{ photo.image_url }}" alt="{{ photo.title }}"
                        class="tw-w-full tw-h-full tw-object-cover group-hover:tw-scale-110 tw-transition-all tw-duration-500">
                </div>
                <div class="tw-p-6">
                    <div class="tw-flex tw-justify-between tw-items-start tw-gap-4">
                        <div class="tw-flex-1">
                            <p class="tw-text-xs tw-text-slate-400 tw-font-mono">{{ photo.id|truncatechars:10 }}</p>
                        </div>
                        <form method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="action" value="delete">
                            <input type="hidden" name="item_id" value="{{ photo.id }}">
                            <button type="submit"
                                class="tw-w-10 tw-h-10 tw-bg-rose-50 tw-text-rose-600 tw-rounded-xl tw-flex tw-items-center tw-justify-center hover:tw-bg-rose-600 hover:tw-text-white tw-transition-all"
                                onclick="return confirm('Delete this photo?')">
                                <i class="bi bi-trash3-fill"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="tw-col-span-full tw-text-center tw-py-20">
                <i class="bi bi-images tw-text-6xl tw-text-slate-300"></i>
                <p class="tw-text-slate-400 tw-mt-4">No photos in gallery yet.</p>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Add Modal -->
<div id="add-modal" class="tw-fixed tw-inset-0 tw-z-[100] tw-hidden tw-flex tw-items-center tw-justify-center tw-p-4">
    <div class="tw-absolute tw-inset-0 tw-bg-slate-900/60 tw-backdrop-blur-sm"
        onclick="this.parentElement.classList.add('tw-hidden')"></div>
    <div
        class="tw-relative tw-w-full tw-max-w-md tw-bg-white tw-rounded-[2.5rem] tw-shadow-2xl tw-p-10 tw-max-h-[90vh] tw-overflow-y-auto">
        <h2 class="tw-text-2xl tw-font-black tw-text-slate-900 tw-mb-8">New Photo Source</h2>
        <form method="POST" enctype="multipart/form-data" class="tw-space-y-6">
            {% csrf_token %}
            <input type="hidden" name="action" value="add">

            <!-- Image Input Method Selector -->
            <div>
                <label class="tw-block tw-text-[10px] tw-font-black tw-text-slate-400 tw-uppercase tw-mb-2">Image Input
                    Method</label>
                <select id="image-method" onchange="toggleImageInput()"
                    class="tw-w-full tw-bg-slate-50 tw-border tw-border-slate-100 tw-rounded-2xl tw-px-6 tw-py-4 tw-text-sm tw-text-slate-900 focus:tw-bg-white tw-outline-none tw-transition-all">
                    <option value="file">Upload Image File</option>
                    <option value="url">Enter Image URL</option>
                </select>
            </div>

            <!-- File Upload Option -->
            <div id="image-file-input">
                <label class="tw-block tw-text-[10px] tw-font-black tw-text-slate-400 tw-uppercase tw-mb-2">Upload Image
                    File</label>
                <input type="file" name="image_file" accept="image/*"
                    class="tw-w-full tw-bg-slate-50 tw-border tw-border-slate-100 tw-rounded-2xl tw-px-6 tw-py-4 tw-text-sm tw-text-slate-900 focus:tw-bg-white tw-outline-none tw-transition-all file:tw-mr-4 file:tw-py-2 file:tw-px-4 file:tw-rounded-full file:tw-border-0 file:tw-text-sm file:tw-font-semibold file:tw-bg-blue-50 file:tw-text-blue-700 hover:file:tw-bg-blue-100">
                <p class="tw-text-xs tw-text-slate-500 tw-mt-2">Max 1920x1080, auto-optimized</p>
            </div>

            <!-- URL Input Option -->
            <div id="image-url-input" class="tw-hidden">
                <label class="tw-block tw-text-[10px] tw-font-black tw-text-slate-400 tw-uppercase tw-mb-2">Image
                    URL</label>
                <input type="text" name="image_url" placeholder="https://..."
                    class="tw-w-full tw-bg-slate-50 tw-border tw-border-slate-100 tw-rounded-2xl tw-px-6 tw-py-4 tw-text-sm tw-text-slate-900 focus:tw-bg-white tw-outline-none tw-transition-all">
            </div>

            <div class="tw-pt-4">
                <button type="submit"
                    class="tw-w-full tw-bg-blue-600 tw-text-white tw-py-4 tw-rounded-2xl tw-font-bold hover:tw-bg-blue-700 tw-transition-all">
                    Register Photo
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    function toggleImageInput() {
        const method = document.getElementById('image-method').value;
        const fileInput = document.getElementById('image-file-input');
        const urlInput = document.getElementById('image-url-input');

        if (method === 'file') {
            fileInput.classList.remove('tw-hidden');
            urlInput.classList.add('tw-hidden');
            // Clear URL input when switching to file
            urlInput.querySelector('input').value = '';
        } else {
            fileInput.classList.add('tw-hidden');
            urlInput.classList.remove('tw-hidden');
            // Clear file input when switching to URL
            fileInput.querySelector('input').value = '';
        }
    }
</script>
{% endblock %}